<div class="container mt-4">
  <h1 class="text-center mb-4">{{ receitaId ? 'Editar Receita' : 'Cadastrar Receita' }}</h1>
  <form [formGroup]="formulario" (ngSubmit)="salvarReceita()">
    <div class="mb-3">
      <label for="titulo" class="form-label">Nome da Receita</label>
      <input
        type="text"
        id="titulo"
        class="form-control"
        formControlName="titulo"
        placeholder="Digite o nome da receita"
      />
      <div *ngIf="formulario.get('titulo')?.invalid && formulario.get('titulo')?.touched" class="text-danger">
        O nome é obrigatório.
      </div>
    </div>

    <div class="mb-3 row align-items-start">
      <div class="col-3">
        <label for="imagem" class="form-label">Imagem da Receita</label>
        <input
          type="file"
          id="imagem"
          class="form-control"
          formControlName="imagem"
          accept="image/*"
        />
      </div>
      <div class="col-9">
        <label for="descricao" class="form-label">Descrição</label>
        <textarea
          id="descricao"
          class="form-control"
          formControlName="descricao"
          placeholder="Digite a descrição da receita"
        ></textarea>
      </div>
    </div>

    <div class="mb-3">
      <label for="rendimento" class="form-label">Rendimento</label>
      <input
        type="text"
        id="rendimento"
        class="form-control"
        formControlName="rendimento"
        placeholder="Ex: 4 porções"
      />
    </div>

    <div class="mb-3">
      <label for="tempo_preparo" class="form-label">Tempo de Preparo</label>
      <input
        type="text"
        id="tempo_preparo"
        class="form-control"
        formControlName="tempo_preparo"
        placeholder="Ex: 30 minutos"
      />
    </div>

    <div class="d-flex justify-content-center my-4">
      <button (click)="modal_selecao.abrirModal()" type="button" class="btn btn-success d-flex align-items-center">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"/>
        </svg> Adicionar Material
      </button>
    </div>

    <div class="mb-3">
      <h2 class="text-center">Lista de Ingredientes</h2>
      <app-lista-ingredientes
        [ingredientes]="ingredientes"
        (editar)="onEditarIngrediente($event)"
        (excluir)="onExcluirIngrediente($event)"
      ></app-lista-ingredientes>
    </div>

    <div class="row align-items-end mt-4">
      <div class="col-4">
        <label for="lucroDireto" class="form-label">Lucro Gastos Diretos (%)</label>
        <input
          type="number"
          id="lucroDireto"
          class="form-control"
          formControlName="lucroDireto"
          placeholder="Ex: 20"
          min="0"
        />
      </div>
      <div class="col-4">
        <label for="lucroIndireto" class="form-label">Lucro Gastos Indiretos (%)</label>
        <input
          type="number"
          id="lucroIndireto"
          class="form-control"
          formControlName="lucroIndireto"
          placeholder="Ex: 10"
          min="0"
        />
      </div>
      <div class="col-4 d-flex align-items-end">
        <button type="button" class="btn btn-success w-100">Calcular</button>
      </div>
    </div>

    <div class="text-end mt-4">
      <button type="submit" class="btn btn-primary" [disabled]="formulario.invalid">Salvar</button>
      <button type="button" class="btn btn-secondary" routerLink="/receitas">Cancelar</button>
    </div>
  </form>
</div>

<app-modal-selecao-material #modal_selecao (materialSelecionado)="onSelecionarProduto($event)"></app-modal-selecao-material>
<app-modal-detalhes-produto #modal_detalhes_produto (confirmarDetalhes)="onConfirmarDetalhesIngrediente($event)"></app-modal-detalhes-produto>
